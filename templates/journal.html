{% extends "base.html" %}

{% block title %}My Journals - DAY WISE{% endblock %}

{% block content %}
<style>
  .journals-container {
    max-width: 1000px;
    margin: 0 auto;
  }

  .journals-header {
    background: rgba(255, 248, 240, 0.95);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
    border: 1px solid rgba(255, 200, 150, 0.3);
    text-align: center;
  }

  .journals-header h1 {
    color: #d97706;
    font-size: 2.2rem;
    font-weight: 600;
    margin-bottom: 10px;
  }

  .journals-header p {
    color: #92400e;
    font-size: 1rem;
  }

  .controls-section {
    background: rgba(255, 248, 240, 0.95);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 25px;
    border: 1px solid rgba(255, 200, 150, 0.3);
  }

  .search-box {
    position: relative;
  }

  .search-input {
    width: 100%;
    padding: 12px 45px 12px 20px;
    border: 2px solid rgba(251, 191, 36, 0.4);
    border-radius: 50px;
    background: rgba(255, 255, 255, 0.9);
    color: #78350f;
    font-size: 1rem;
    transition: all 0.3s;
  }

  .search-input:focus {
    outline: none;
    border-color: #f97316;
    box-shadow: 0 0 0 4px rgba(249, 115, 22, 0.1);
    background: #ffffff;
  }

  .search-input::placeholder {
    color: #d97706;
    opacity: 0.6;
  }

  .search-icon {
    position: absolute;
    right: 18px;
    top: 50%;
    transform: translateY(-50%);
    color: #f97316;
  }

  .sort-section {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .sort-label {
    color: #92400e;
    font-weight: 600;
    font-size: 0.95rem;
  }

  .sort-select {
    padding: 10px 15px;
    border: 2px solid rgba(251, 191, 36, 0.4);
    border-radius: 50px;
    background: rgba(255, 255, 255, 0.9);
    color: #78350f;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.3s;
  }

  .sort-select:focus {
    outline: none;
    border-color: #f97316;
    box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
  }

  .journal-card {
    background: rgba(255, 248, 240, 0.95);
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 200, 150, 0.3);
    transition: all 0.3s;
    cursor: pointer;
  }

  .journal-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(249, 115, 22, 0.2);
    border-color: #f97316;
  }

  .journal-card-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 15px;
  }

  .journal-title {
    color: #d97706;
    font-size: 1.4rem;
    font-weight: 600;
    margin: 0;
    flex: 1;
  }

  .journal-date {
    display: flex;
    align-items: center;
    gap: 6px;
    color: #92400e;
    font-size: 0.9rem;
    white-space: nowrap;
  }

  .journal-date svg {
    color: #f97316;
  }

  .journal-preview {
    color: #78350f;
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 15px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .journal-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 15px;
    border-top: 1px solid rgba(251, 191, 36, 0.3);
  }

  .read-more-btn {
    padding: 8px 20px;
    background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s;
  }

  .read-more-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
  }

  .word-count {
    color: #92400e;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    background: rgba(255, 248, 240, 0.95);
    border-radius: 15px;
    border: 1px solid rgba(255, 200, 150, 0.3);
  }

  .empty-state svg {
    color: #f97316;
    margin-bottom: 20px;
  }

  .empty-state h3 {
    color: #d97706;
    font-size: 1.5rem;
    margin-bottom: 10px;
  }

  .empty-state p {
    color: #92400e;
    margin-bottom: 25px;
  }

  .start-writing-btn {
    padding: 12px 30px;
    background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
    border: none;
    border-radius: 50px;
    color: white;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s;
  }

  .start-writing-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
    color: white;
  }

  .stats-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 15px;
    background: rgba(249, 115, 22, 0.1);
    border-radius: 20px;
    color: #ea580c;
    font-weight: 600;
    font-size: 0.9rem;
  }

  @media (max-width: 768px) {
    .journals-header h1 {
      font-size: 1.7rem;
    }

    .controls-section {
      padding: 20px;
    }

    .sort-section {
      margin-top: 15px;
      width: 100%;
    }

    .sort-select {
      width: 100%;
    }

    .journal-card-header {
      flex-direction: column;
      gap: 10px;
    }

    .journal-title {
      font-size: 1.2rem;
    }

    .journal-footer {
      flex-direction: column;
      gap: 10px;
      align-items: start;
    }

    .read-more-btn {
      width: 100%;
    }
  }
</style>

<div class="journals-container">
  <!-- Header -->
  <div class="journals-header">
    <h1>
      <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-journal-bookmark me-2" viewBox="0 0 16 16" style="vertical-align: middle;">
        <path fill-rule="evenodd" d="M6 8V1h1v6.117L8.743 6.07a.5.5 0 0 1 .514 0L11 7.117V1h1v7a.5.5 0 0 1-.757.429L9 7.083 6.757 8.43A.5.5 0 0 1 6 8"/>
        <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2"/>
        <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1z"/>
      </svg>
      My Journals
    </h1>
    <p>
      <span class="stats-badge">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-journal-text" viewBox="0 0 16 16">
          <path d="M5 10.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5m0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m0-2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5"/>
          <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2"/>
          <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1z"/>
        </svg>
        {{ total_entries }} Total Entries
      </span>
    </p>
  </div>

  <!-- Search and Sort Controls -->
  <div class="controls-section">
    <div class="row align-items-center">
      <div class="col-md-8 mb-3 mb-md-0">
        <div class="search-box">
          <input 
            type="text" 
            class="search-input" 
            id="searchInput" 
            placeholder="Search journals by title..."
            onkeyup="searchJournals()"
          >
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search search-icon" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
          </svg>
        </div>
      </div>
      <div class="col-md-4">
        <div class="sort-section">
          <label class="sort-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sort-down me-1" viewBox="0 0 16 16">
              <path d="M3.5 2.5a.5.5 0 0 0-1 0v8.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 1.999.007.007a.497.497 0 0 0 .7-.006l2-2a.5.5 0 0 0-.707-.708L3.5 11.293zm3.5 1a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M7.5 6a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zm0 3a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1zm0 3a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z"/>
            </svg>
            Sort:
          </label>
          <select class="sort-select" id="sortSelect" onchange="sortJournals()">
            <option value="desc">Newest First</option>
            <option value="asc">Oldest First</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Journal Cards -->
  <div id="journalsList">
    {% if entries %}
      {% for entry in entries %}
      <div class="journal-card" data-title="{{ entry.title.lower() }}" data-date="{{ entry.diary_time.strftime('%d %b %Y %H:%M') }}" onclick="window.location.href='/view-entry/{{ entry.id }}'">
        <div class="journal-card-header">
          <h3 class="journal-title">{{ entry.title }}</h3>
          <div class="journal-date">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar3" viewBox="0 0 16 16">
              <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2M1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857z"/>
              <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2m3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
            </svg>
            {{ entry.diary_time.strftime('%b %d, %Y') }}
          </div>
        </div>
        <p class="journal-preview">{{ entry.content[:200] }}{% if entry.content|length > 200 %}...{% endif %}</p>
        <div class="journal-footer">
          <div class="word-count">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-file-text" viewBox="0 0 16 16">
              <path d="M5 4a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5M5 8a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1z"/>
              <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1"/>
            </svg>
            {{ entry.content.split()|length }} words
          </div>
          <button class="read-more-btn" onclick="event.stopPropagation(); window.location.href='/view-entry/{{ entry.id }}'">
            More About This One
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-arrow-right ms-1" viewBox="0 0 16 16" style="vertical-align: middle;">
              <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8"/>
            </svg>
          </button>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <!-- Empty State -->
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-journal-x" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M6.146 6.146a.5.5 0 0 1 .708 0L8 7.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 8l1.147 1.146a.5.5 0 0 1-.708.708L8 8.707 6.854 9.854a.5.5 0 0 1-.708-.708L7.293 8 6.146 6.854a.5.5 0 0 1 0-.708"/>
          <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2"/>
          <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1z"/>
        </svg>
        <h3>No Journals Yet</h3>
        <p>Start your journaling journey today!</p>
        <a href="{{ url_for('compose') }}" class="start-writing-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-pencil-square me-2" viewBox="0 0 16 16" style="vertical-align: middle;">
            <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
            <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
          </svg>
          Write Your First Entry
        </a>
      </div>
    {% endif %}
  </div>

  <!-- No Results Message (hidden by default) -->
  <div id="noResults" class="empty-state" style="display: none;">
    <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
      <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
    </svg>
    <h3>No Journals Found</h3>
    <p>Try adjusting your search terms</p>
  </div>
</div>

<script>
  // Search function
  function searchJournals() {
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    const journalCards = document.querySelectorAll('.journal-card');
    const noResults = document.getElementById('noResults');
    let visibleCount = 0;

    journalCards.forEach(card => {
      const title = card.getAttribute('data-title');
      if (title.includes(searchInput)) {
        card.style.display = 'block';
        visibleCount++;
      } else {
        card.style.display = 'none';
      }
    });

    // Show/hide no results message
    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
  }

  // Sort function
  function sortJournals() {
    const sortValue = document.getElementById('sortSelect').value;
    const journalsList = document.getElementById('journalsList');
    const journalCards = Array.from(document.querySelectorAll('.journal-card'));

    journalCards.sort((a, b) => {
      const dateA = new Date(a.getAttribute('data-date'));
      const dateB = new Date(b.getAttribute('data-date'));
      
      if (sortValue === 'asc') {
        return dateA - dateB; // Oldest first
      } else {
        return dateB - dateA; // Newest first
      }
    });

    // Re-append sorted cards
    journalCards.forEach(card => {
      journalsList.appendChild(card);
    });
  }
</script>
{% endblock %}